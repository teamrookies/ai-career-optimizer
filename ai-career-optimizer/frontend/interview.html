
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Mock Interview</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <h2>AI Mock Interview</h2>

  <input
    type="text"
    id="interviewType"
    placeholder="e.g. Java Developer Interview, HR Interview, Law Interview"
  />

  <br><br>

  <button onclick="startInterview()">Start Interview</button>
  <button onclick="startVoiceInput()">ðŸŽ¤ Speak Answer</button>
  <button onclick="submitAnswer()">Submit Answer</button>
  <button onclick="finishInterview()">Done</button>

  <h3>AI Question:</h3>
  <p id="question"></p>

  <h3>Your Answer:</h3>
  <textarea id="answer" rows="5"></textarea>

  <h3>AI Feedback:</h3>
  <p id="feedback"></p>

  <script>
    const API_BASE = "https://ai-career-optimizer.onrender.com";

    let currentQuestion = "";
    let allAnswers = [];
    let recognition;

    /* ---------- AI VOICE OUTPUT ---------- */
    function speakAI(text) {
      if (!text) return;
      const speech = new SpeechSynthesisUtterance(text);
      speech.lang = "en-US";
      window.speechSynthesis.speak(speech);
    }

    /* ---------- USER VOICE INPUT ---------- */
    function startVoiceInput() {
      recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = "en-US";
      recognition.start();

      recognition.onresult = function (event) {
        document.getElementById("answer").value =
          event.results[0][0].transcript;
      };
    }

    /* ---------- START INTERVIEW ---------- */
    function startInterview() {
      const interviewType = document.getElementById("interviewType").value;

      fetch(`${API_BASE}/api/interview/start`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ interviewType })
      })
      .then(res => res.json())
      .then(data => {
        currentQuestion = data.question;
        document.getElementById("question").innerText = data.question;
        speakAI(data.question);
      });
    }

    /* ---------- SUBMIT ANSWER ---------- */
    function submitAnswer() {
      const interviewType = document.getElementById("interviewType").value;
      const answer = document.getElementById("answer").value;

      allAnswers.push(`Q: ${currentQuestion}\nA: ${answer}`);

      fetch(`${API_BASE}/api/interview/answer`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          interviewType,
          question: currentQuestion,
          answer
        })
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById("feedback").innerText = data.feedback;
        document.getElementById("question").innerText = data.nextQuestion;
        currentQuestion = data.nextQuestion;
        speakAI(data.nextQuestion);
        document.getElementById("answer").value = "";
      });
    }

    /* ---------- FINAL FEEDBACK ---------- */
    function finishInterview() {
      const interviewType = document.getElementById("interviewType").value;

      fetch(`${API_BASE}/api/interview/feedback`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          interviewType,
          answers: allAnswers
        })
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById("feedback").innerText = data.feedback;
        speakAI(data.feedback);
      });
    }
  </script>

</body>
</html>
